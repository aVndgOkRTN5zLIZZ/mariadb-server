
SET sql_mode=ORACLE;

create table t1 (a int);
create table t2 (b int);
create table t3 (c int);

--echo # b - cyrcle
--error ER_INVALID_USE_OF_ORA_JOIN_CYCLE
select * from t1, t2, t3
  where t1.a = t2.b(+) AND t2.b = t3.c(+) AND
        t3.c = t2.b(+);
--echo # O - cyrcle
--error ER_INVALID_USE_OF_ORA_JOIN_CYCLE
select * from t1, t2, t3
  where t1.a = t2.b(+) AND t2.b = t3.c(+) AND
        t3.c = t1.a(+);
--echo # self-reference cyrcle
--error ER_INVALID_USE_OF_ORA_JOIN_CYCLE
select * from t1, t2, t3
  where t1.a = t2.b(+) AND t2.b = t3.c(+) AND
        t3.c = t3.c(+);

DROP TABLE t1,t2,t3;

create table t1 (a int);
create table t2 (b int);
create table t3 (c int);
create table t4 (d int);
create table t5 (e int);

--echo # complex case
--error ER_INVALID_USE_OF_ORA_JOIN_CYCLE
select * from t1, t2, t3, t4, t5
  where
    t3.c = t4.d(+) AND t4.d = t3.c(+) AND
    t1.a = t5.e(+) AND t2.b = t5.e(+) AND
    t2.b = t3.c(+)
    ;

DROP TABLE t1,t2,t3,t4,t5;
